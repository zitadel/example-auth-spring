<!DOCTYPE html>
<html layout:decorate="~{layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.ultraq.net.nz/thymeleaf/layout ">
<head>
  <title>Sign In</title>
</head>
<body>
<div class="w-full" layout:fragment="content">
  <main class="grid flex-1 place-items-center bg-white px-6 py-24 sm:py-32 lg:px-8">
    <div class="w-full max-w-md text-center">
      <div class="mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-blue-100">
        <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" stroke-linecap="round"
                stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="text-5xl font-semibold tracking-tight text-balance text-gray-900 sm:text-7xl">Sign in</h1>

      <p class="mt-6 text-lg font-medium text-pretty sm:text-xl/8 text-red-600" th:if="${message != null}"
         th:text="${message.message}"></p>
      <p class="mt-6 text-lg font-medium text-pretty sm:text-xl/8 text-gray-500" th:unless="${message != null}">Continue
        to your account</p>

      <div class="mt-10" th:each="provider : ${providers}">
        <form class="space-y-4" id="signinForm" method="POST" th:action="${provider.signinUrl}">
          <input name="callbackUrl" th:value="${callbackUrl}" type="hidden"/>
          <button class="flex w-full items-center justify-center gap-3 rounded-lg bg-blue-600 px-4 py-3 font-semibold text-white transition duration-200 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed" id="signinButton"
                  type="submit">
            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
              <path clip-rule="evenodd"
                    d="M8 10V7a4 4 0 1 1 8 0v3h1a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h1Zm2-3a2 2 0 1 1 4 0v3h-4V7Zm2 6a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1Z"
                    fill-rule="evenodd"/>
            </svg>
            <span id="signinText" th:text="|Sign in with ${provider.name}|">Sign in with Provider</span>
          </button>
        </form>
      </div>

      <div class="mt-8">
        <a class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700" th:href="@{/}">
          <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to home
        </a>
      </div>
    </div>
  </main>
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('signinForm');
      const button = document.getElementById('signinButton');
      const buttonText = document.getElementById('signinText');
      if (form && button && buttonText) {
        const originalText = buttonText.textContent;
        form.addEventListener('submit', async function (e) {
          e.preventDefault();
          button.disabled = true;
          buttonText.textContent = 'Signing inâ€¦';
          try {
            const response = await fetch('/auth/csrf');
            const data = await response.json();
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'csrfToken';
            input.value = data.csrfToken;
            form.appendChild(input);
            form.submit();
          } catch (error) {
            alert('Sign-in failed. Please try again.');
            button.disabled = false;
            buttonText.textContent = originalText;
          }
        });
      }
    });
  </script>
</div>
</body>
</html>
